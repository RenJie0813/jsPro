"use strict";function initPage(){games=JSON.parse(sessionStorage.newVer).games;for(var t=0;t<games.length;t++)gameNameList[games[t][0]]=games[t][1];getGameData()}function getGameData(){var t=JSON.parse(localStorage.verId);sendRequest("ver.getInfo",[+t],function(t){render(t.data),addEvent()})}function refreshTable(t){for(var e=0;e<t.games.length;e++)$("#tb").append('\n        <tr class="lineData">\n            <td>'+t.games[e][0]+"</td>\n            <td>"+t.games[e][1]+'</td>\n            <td class="editTd ">'+t.games[e][2]+'</td>\n            <td class="editTd ">'+t.games[e][3]+'</td>\n            <td class="editTd ">'+t.games[e][4]+'</td>\n            <td class="editTd ">'+t.games[e][5]+'</td>\n            <td class="editTd ">'+t.games[e][6]+'</td>\n            <td class="editTd ">'+t.games[e][7]+'</td>\n            <td class="editTd ">'+t.games[e][8]+'</td>\n            <td class="editTd ">'+t.games[e][9]+'</td>\n            <td><span class="editBtn">当前替换</span></td>\n        </tr>\n         ');addEvent()}function changeToEdit(t){t.html("");var e=$("<input type='text' style='text-align: center'/>");e.css("border","0").css("background-color",t.css("background-color")).css("font-size",t.css("font-size")).css("height","20px").css("width",t.css("width")).val(editContent).appendTo(t).get(0).select(),e.click(function(){return!1}).keyup(function(e){var n=e.which;13==n&&t.html(t.children("input").val()),27==n&&t.html(editContent)}).blur(function(){t.children("input").val()!=editContent?t.html(t.children("input").val()):t.html(editContent)})}function renderHead(){var t=["id","游戏名","server","base","sound","sheets","ui","rule","loader","guide","操作"];$("#tb").append('<tr class="th">\n            <td >'+t[0]+"</td>      \n            <td>"+t[1]+'</td>\n            <td class="short">'+t[2]+'</td>\n            <td class="short">'+t[3]+'</td>\n            <td class="short">'+t[4]+'</td>\n            <td class="short">'+t[5]+'</td>\n            <td class="short">'+t[6]+'</td>\n            <td class="short">'+t[7]+'</td>\n            <td class="short">'+t[8]+'</td>\n            <td class="short">'+t[9]+"</td>\n            <td>"+t[10]+"</td>\n    \n        </tr>")}function render(t){if(renderHead(),t.info)for(var e in t.info)$("#tb").append('\n        <tr class="lineData">\n            <td >'+e+"</td>\n            <td >"+gameNameList[e]+'</td>\n            <td class="editTd ">'+t.info[e].server+'</td>\n            <td class="editTd ">'+t.info[e].base+'</td>\n            <td class="editTd ">'+t.info[e].sound+'</td>\n            <td class="editTd ">'+t.info[e].sheets+'</td>\n            <td class="editTd ">'+t.info[e].ui+'</td>\n            <td class="editTd ">'+t.info[e].rule+'</td>\n            <td class="editTd ">'+t.info[e].loader+'</td>\n            <td class="editTd ">'+t.info[e].guide+'</td>\n            <td><span class="editBtn">当前替换</span></td>\n        </tr>\n        ');else $("#tb").append('\n            <td colspan="11" class="noInfo" style="height: 50px;font-size: 14px;text-align: center;vertical-align:middle;cursor: pointer;color:#39A3F9 ">暂无数据...</td>\n         ');addEvent()}function addEvent(){$(".editTd").unbind().bind("click",function(){var t=$(this);editContent=t.html(),changeToEdit(t)}),$("#auto").unbind().bind("click",function(){var t=JSON.parse(sessionStorage.newVer);if(0===$(".editTd").length){var e=$("#tb").html();$("#tb").html(""),renderHead(),refreshTable(t),history.push({ctrl:"none-exist",beforeChange:e})}else{var n=$("#tb").html();$("#tb").html(""),renderHead(),refreshTable(t),history.push({ctrl:"modify-exist",beforeChange:n})}$(".editTd").unbind().bind("click",function(){var t=$(this);editContent=t.html(),changeToEdit(t)})}),$("#back").unbind().bind("click",function(){if(history.length){var t=history.pop();$("#tb").html(""),$("#tb").html(t.beforeChange),addEvent()}}),$(".editBtn").unbind().bind("click",function(){var t=$(this).parent().parent().children(),e=t.eq(0).text();if(lineHistory[e]||(lineHistory[e]={old:null,new:null,switched:!1}),lineHistory[e].old&&lineHistory[e].new&&lineHistory[e].switched)$(this).parent().parent().html(lineHistory[e].old),lineHistory[e].switched=!1;else{lineHistory[e].old=$(this).parent().parent().html();for(var n=void 0,d=0;d<games.length;d++)games[d][0]===e&&(n=games[d]);t.eq(2).text(n[2]),t.eq(3).text(n[3]),t.eq(4).text(n[4]),t.eq(5).text(n[5]),t.eq(6).text(n[6]),t.eq(7).text(n[7]),t.eq(8).text(n[8]),t.eq(9).text(n[9]),lineHistory[e].new=$(this).parent().parent().html(),lineHistory[e].switched=!0}addEvent()}),$(".game_btn").unbind().bind("click",function(){var t={},e=+localStorage.verId;$(".lineData").each(function(){var e=$(this).children();t[e.eq(0).text()]={server:+e.eq(2).text(),base:+e.eq(3).text(),sound:+e.eq(4).text(),sheets:+e.eq(5).text(),ui:+e.eq(6).text(),rule:+e.eq(7).text(),loader:+e.eq(8).text(),guide:+e.eq(9).text()}}),sendRequest("ver.upGames",[e,t],function(t){0===t.code?alert("修改成功"):alert("修改失败")})})}$(document).ready(function(){initPage()});var games,editContent,history=[],lineHistory={},gameNameList={};